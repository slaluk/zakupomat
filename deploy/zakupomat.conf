<VirtualHost *:80>
    ServerName zakupomat.anslan.pl

    DocumentRoot /var/www/zakupomat/frontend/dist

    <Directory /var/www/zakupomat/frontend/dist>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        RewriteEngine On
        RewriteBase /
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_URI} !^/api
        RewriteRule ^ index.html [L]
    </Directory>

    ProxyPreserveHost On
    ProxyPass /api http://localhost:8000/api
    ProxyPassReverse /api http://localhost:8000/api

    <Location /api/sse>
        ProxyPass http://localhost:8000/api/sse
        ProxyPassReverse http://localhost:8000/api/sse
        SetEnv proxy-sendchunked 1
        SetEnv proxy-sendcl 0
    </Location>

    <LocationMatch "\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$">
        Header set Cache-Control "public, max-age=31536000, immutable"
    </LocationMatch>

    ErrorLog ${APACHE_LOG_DIR}/zakupomat_error.log
    CustomLog ${APACHE_LOG_DIR}/zakupomat_access.log combined
</VirtualHost>
